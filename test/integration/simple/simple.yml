---
- name         : Simple
  hosts        : "{{ kitchen_hosts }}"
  gather_facts : true
  sudo         : True
  connection   : "{{ kitchen_connection | default('local') }}"
  vars         :
        nginx_site                       :
           - file_name                   : "test"
             blocks                      :
               - type                    : "server"
                 index                   : "index.htm index.html"
                 server_name             : "localhost"
                 listen                  : "1080"
                 ## Use josn
                 location1               : {
                                             name: /,
                                             type: location,
                                             try_files: "$uri $uri/ /index.html",
                                             root: "{{ nginx_default_root }}"
                                           }
                 ## Use yaml
                 location2               : 
                             name        : /doc/
                             type        : location
                             alias       : "/usr/share/doc/"
                             autoindex   : "on" 
                             allow       : "127.0.0.2"
                             deny        : "all" 
  pre_tasks:
            - name: update apt
              apt: update_cache=yes cache_valid_time=3600

  roles        :
                 - "ansible-nginx"

